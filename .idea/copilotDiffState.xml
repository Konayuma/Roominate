<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/roominate/activities/auth/SignUpEmailActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/roominate/activities/auth/SignUpEmailActivity.java" />
              <option name="originalContent" value="package com.roominate.activities.auth;&#10;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.text.TextUtils;&#10;import android.util.Patterns;&#10;import android.view.View;&#10;import android.widget.Button;&#10;import android.widget.ImageView;&#10;import android.widget.ProgressBar;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import com.google.android.material.textfield.TextInputEditText;&#10;import com.google.android.material.textfield.TextInputLayout;&#10;import com.roominate.R;&#10;import com.roominate.services.SupabaseClient;&#10;import org.json.JSONObject;&#10;&#10;public class SignUpEmailActivity extends AppCompatActivity {&#10;&#10;    private ImageView logoImage;&#10;    private TextView titleText;&#10;    private TextView subtitleText;&#10;    private TextInputLayout emailLayout;&#10;    private TextInputEditText emailEditText;&#10;    private Button continueButton;&#10;    private ProgressBar progressBar;&#10;    private String userRole, firstName, lastName, dob, phone, password;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        &#10;        // Hide ActionBar if present&#10;        if (getSupportActionBar() != null) {&#10;            getSupportActionBar().hide();&#10;        }&#10;        &#10;        setContentView(R.layout.activity_signup_email);&#10;&#10;        // Get user role and basic info from previous screen&#10;        userRole = getIntent().getStringExtra(&quot;userRole&quot;);&#10;        firstName = getIntent().getStringExtra(&quot;firstName&quot;);&#10;        lastName = getIntent().getStringExtra(&quot;lastName&quot;);&#10;        dob = getIntent().getStringExtra(&quot;dob&quot;);&#10;        phone = getIntent().getStringExtra(&quot;phone&quot;);&#10;        password = getIntent().getStringExtra(&quot;password&quot;);&#10;&#10;        initializeViews();&#10;        setupListeners();&#10;    }&#10;&#10;    private void initializeViews() {&#10;        logoImage = findViewById(R.id.logoImage);&#10;        titleText = findViewById(R.id.titleText);&#10;        subtitleText = findViewById(R.id.subtitleText);&#10;        emailLayout = findViewById(R.id.emailLayout);&#10;        emailEditText = findViewById(R.id.emailEditText);&#10;        continueButton = findViewById(R.id.continueButton);&#10;        progressBar = findViewById(R.id.progressBar);&#10;    }&#10;&#10;    private void setupListeners() {&#10;        continueButton.setOnClickListener(v -&gt; validateAndContinue());&#10;&#10;        // Real-time validation&#10;        emailEditText.setOnFocusChangeListener((v, hasFocus) -&gt; {&#10;            if (!hasFocus) {&#10;                validateEmail();&#10;            }&#10;        });&#10;    }&#10;&#10;    private boolean validateEmail() {&#10;        String email = emailEditText.getText().toString().trim();&#10;        if (TextUtils.isEmpty(email)) {&#10;            emailLayout.setError(&quot;Email is required&quot;);&#10;            return false;&#10;        } else if (!Patterns.EMAIL_ADDRESS.matcher(email).matches()) {&#10;            emailLayout.setError(&quot;Invalid email address&quot;);&#10;            return false;&#10;        } else {&#10;            emailLayout.setError(null);&#10;            return true;&#10;        }&#10;    }&#10;&#10;    private void validateAndContinue() {&#10;        if (validateEmail()) {&#10;            proceedToVerification();&#10;        }&#10;    }&#10;&#10;    private void proceedToVerification() {&#10;        String email = emailEditText.getText().toString().trim();&#10;&#10;        if (email.isEmpty()) {&#10;            emailEditText.setError(&quot;Email is required&quot;);&#10;            return;&#10;        }&#10;&#10;        if (!isEmailValid(email)) {&#10;            emailEditText.setError(&quot;Please enter a valid email address&quot;);&#10;            return;&#10;        }&#10;&#10;        // Show loading&#10;        progressBar.setVisibility(View.VISIBLE);&#10;        continueButton.setEnabled(false);&#10;&#10;        // Use a dummy password for initial signup - will be updated after confirmation&#10;        String dummyPassword = &quot;TempPass123!&quot;;&#10;&#10;        SupabaseClient.getInstance().signUp(&#10;            firstName != null ? firstName : &quot;&quot;,&#10;            lastName != null ? lastName : &quot;&quot;,&#10;            email,&#10;            phone != null ? phone : &quot;&quot;,&#10;            dummyPassword,&#10;            userRole != null ? userRole : &quot;tenant&quot;,&#10;            new SupabaseClient.ApiCallback() {&#10;                @Override&#10;                public void onSuccess(JSONObject response) {&#10;                    runOnUiThread(() -&gt; {&#10;                        progressBar.setVisibility(View.GONE);&#10;                        continueButton.setEnabled(true);&#10;                        Toast.makeText(SignUpEmailActivity.this,&#10;                            &quot;Confirmation code sent! Please check your email.&quot;, Toast.LENGTH_LONG).show();&#10;&#10;                        Intent intent = new Intent(SignUpEmailActivity.this, EmailConfirmationActivity.class);&#10;                        intent.putExtra(&quot;email&quot;, email);&#10;                        intent.putExtra(&quot;userType&quot;, userRole);&#10;                        intent.putExtra(&quot;firstName&quot;, firstName);&#10;                        intent.putExtra(&quot;lastName&quot;, lastName);&#10;                        intent.putExtra(&quot;phone&quot;, phone);&#10;                        intent.putExtra(&quot;dummyPassword&quot;, dummyPassword);&#10;                        startActivity(intent);&#10;                        finish();&#10;                    });&#10;                }&#10;&#10;                @Override&#10;                public void onError(String error) {&#10;                    runOnUiThread(() -&gt; {&#10;                        progressBar.setVisibility(View.GONE);&#10;                        continueButton.setEnabled(true);&#10;                        Toast.makeText(SignUpEmailActivity.this, &quot;Sign up failed: &quot; + error, Toast.LENGTH_LONG).show();&#10;                    });&#10;                }&#10;            }&#10;        );&#10;    }&#10;&#10;    private boolean isEmailValid(String email) {&#10;        return email.contains(&quot;@&quot;) &amp;&amp; email.contains(&quot;.&quot;);&#10;    }&#10;&#10;    @Override&#10;    public void onBackPressed() {&#10;        super.onBackPressed();&#10;        overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_right);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.roominate.activities.auth;&#10;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.text.TextUtils;&#10;import android.util.Patterns;&#10;import android.view.View;&#10;import android.widget.Button;&#10;import android.widget.ImageView;&#10;import android.widget.ProgressBar;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import com.google.android.material.textfield.TextInputEditText;&#10;import com.google.android.material.textfield.TextInputLayout;&#10;import com.roominate.R;&#10;import com.roominate.services.SupabaseClient;&#10;import org.json.JSONObject;&#10;&#10;public class SignUpEmailActivity extends AppCompatActivity {&#10;&#10;    private ImageView logoImage;&#10;    private TextView titleText;&#10;    private TextView subtitleText;&#10;    private TextInputLayout emailLayout;&#10;    private TextInputEditText emailEditText;&#10;    private Button continueButton;&#10;    private ProgressBar progressBar;&#10;    private String userRole, firstName, lastName, dob, phone, password;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        &#10;        // Hide ActionBar if present&#10;        if (getSupportActionBar() != null) {&#10;            getSupportActionBar().hide();&#10;        }&#10;        &#10;        setContentView(R.layout.activity_signup_email);&#10;&#10;        // Get user role and basic info from previous screen&#10;        userRole = getIntent().getStringExtra(&quot;userRole&quot;);&#10;        firstName = getIntent().getStringExtra(&quot;firstName&quot;);&#10;        lastName = getIntent().getStringExtra(&quot;lastName&quot;);&#10;        dob = getIntent().getStringExtra(&quot;dob&quot;);&#10;        phone = getIntent().getStringExtra(&quot;phone&quot;);&#10;        password = getIntent().getStringExtra(&quot;password&quot;);&#10;&#10;        initializeViews();&#10;        setupListeners();&#10;    }&#10;&#10;    private void initializeViews() {&#10;        logoImage = findViewById(R.id.logoImage);&#10;        titleText = findViewById(R.id.titleText);&#10;        subtitleText = findViewById(R.id.subtitleText);&#10;        emailLayout = findViewById(R.id.emailLayout);&#10;        emailEditText = findViewById(R.id.emailEditText);&#10;        continueButton = findViewById(R.id.continueButton);&#10;        progressBar = findViewById(R.id.progressBar);&#10;    }&#10;&#10;    private void setupListeners() {&#10;        continueButton.setOnClickListener(v -&gt; validateAndContinue());&#10;&#10;        // Real-time validation&#10;        emailEditText.setOnFocusChangeListener((v, hasFocus) -&gt; {&#10;            if (!hasFocus) {&#10;                validateEmail();&#10;            }&#10;        });&#10;    }&#10;&#10;    private boolean validateEmail() {&#10;        String email = emailEditText.getText().toString().trim();&#10;        if (TextUtils.isEmpty(email)) {&#10;            emailLayout.setError(&quot;Email is required&quot;);&#10;            return false;&#10;        } else if (!Patterns.EMAIL_ADDRESS.matcher(email).matches()) {&#10;            emailLayout.setError(&quot;Invalid email address&quot;);&#10;            return false;&#10;        } else {&#10;            emailLayout.setError(null);&#10;            return true;&#10;        }&#10;    }&#10;&#10;    private void validateAndContinue() {&#10;        if (validateEmail()) {&#10;            proceedToVerification();&#10;        }&#10;    }&#10;&#10;    private void proceedToVerification() {&#10;        String email = emailEditText.getText().toString().trim();&#10;&#10;        if (email.isEmpty()) {&#10;            emailEditText.setError(&quot;Email is required&quot;);&#10;            return;&#10;        }&#10;&#10;        if (!isEmailValid(email)) {&#10;            emailEditText.setError(&quot;Please enter a valid email address&quot;);&#10;            return;&#10;        }&#10;&#10;        // Show loading&#10;        progressBar.setVisibility(View.VISIBLE);&#10;        continueButton.setEnabled(false);&#10;&#10;        // Use a dummy password for initial signup - will be updated after confirmation&#10;        String dummyPassword = &quot;TempPass123!&quot;;&#10;&#10;        SupabaseClient.getInstance().signUp(&#10;            firstName != null ? firstName : &quot;&quot;,&#10;            lastName != null ? lastName : &quot;&quot;,&#10;            email,&#10;            phone != null ? phone : &quot;&quot;,&#10;            dummyPassword,&#10;            userRole != null ? userRole : &quot;tenant&quot;,&#10;            new SupabaseClient.ApiCallback() {&#10;                @Override&#10;                public void onSuccess(JSONObject response) {&#10;                    runOnUiThread(() -&gt; {&#10;                        progressBar.setVisibility(View.GONE);&#10;                        continueButton.setEnabled(true);&#10;                        Toast.makeText(SignUpEmailActivity.this,&#10;                            &quot;Confirmation code sent! Please check your email.&quot;, Toast.LENGTH_LONG).show();&#10;&#10;                        Intent intent = new Intent(SignUpEmailActivity.this, SignUpEmailVerificationActivity.class);&#10;                        intent.putExtra(&quot;email&quot;, email);&#10;                        intent.putExtra(&quot;userRole&quot;, userRole);&#10;                        intent.putExtra(&quot;firstName&quot;, firstName);&#10;                        intent.putExtra(&quot;lastName&quot;, lastName);&#10;                        intent.putExtra(&quot;phone&quot;, phone);&#10;                        intent.putExtra(&quot;dummyPassword&quot;, dummyPassword);&#10;                        startActivity(intent);&#10;                        finish();&#10;                    });&#10;                }&#10;&#10;                @Override&#10;                public void onError(String error) {&#10;                    runOnUiThread(() -&gt; {&#10;                        progressBar.setVisibility(View.GONE);&#10;                        continueButton.setEnabled(true);&#10;                        Toast.makeText(SignUpEmailActivity.this, &quot;Sign up failed: &quot; + error, Toast.LENGTH_LONG).show();&#10;                    });&#10;                }&#10;            }&#10;        );&#10;    }&#10;&#10;    private boolean isEmailValid(String email) {&#10;        return email.contains(&quot;@&quot;) &amp;&amp; email.contains(&quot;.&quot;);&#10;    }&#10;&#10;    @Override&#10;    public void onBackPressed() {&#10;        super.onBackPressed();&#10;        overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_right);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/roominate/activities/auth/SignUpEmailVerificationActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/roominate/activities/auth/SignUpEmailVerificationActivity.java" />
              <option name="originalContent" value="package com.roominate.activities.auth;&#10;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.os.CountDownTimer;&#10;import android.text.Editable;&#10;import android.text.TextWatcher;&#10;import android.util.Log;&#10;import android.view.View;&#10;import android.widget.EditText;&#10;import android.widget.ImageView;&#10;import android.widget.ProgressBar;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import com.roominate.R;&#10;import com.roominate.services.SupabaseClient;&#10;import org.json.JSONObject;&#10;&#10;public class SignUpEmailVerificationActivity extends AppCompatActivity {&#10;&#10;    private ImageView logoImage;&#10;    private TextView titleText;&#10;    private TextView emailText;&#10;    private EditText code1, code2, code3, code4, code5, code6;&#10;    private TextView resendText;&#10;    private ProgressBar progressBar;&#10;    &#10;    private String userRole, firstName, lastName, dob, phone, email;&#10;    private CountDownTimer countDownTimer;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        &#10;        // Hide ActionBar if present&#10;        if (getSupportActionBar() != null) {&#10;            getSupportActionBar().hide();&#10;        }&#10;        &#10;        setContentView(R.layout.activity_signup_email_verification);&#10;&#10;        // Get data from previous screens&#10;        userRole = getIntent().getStringExtra(&quot;userRole&quot;);&#10;        firstName = getIntent().getStringExtra(&quot;firstName&quot;);&#10;        lastName = getIntent().getStringExtra(&quot;lastName&quot;);&#10;        dob = getIntent().getStringExtra(&quot;dob&quot;);&#10;        phone = getIntent().getStringExtra(&quot;phone&quot;);&#10;        email = getIntent().getStringExtra(&quot;email&quot;);&#10;&#10;        initializeViews();&#10;        setupListeners();&#10;        startResendTimer();&#10;    }&#10;&#10;    private void initializeViews() {&#10;        logoImage = findViewById(R.id.logoImage);&#10;        titleText = findViewById(R.id.titleText);&#10;        emailText = findViewById(R.id.emailText);&#10;        code1 = findViewById(R.id.code1);&#10;        code2 = findViewById(R.id.code2);&#10;        code3 = findViewById(R.id.code3);&#10;        code4 = findViewById(R.id.code4);&#10;        code5 = findViewById(R.id.code5);&#10;        code6 = findViewById(R.id.code6);&#10;        resendText = findViewById(R.id.resendText);&#10;        progressBar = findViewById(R.id.progressBar);&#10;&#10;        emailText.setText(&quot;We've sent a 6-digit code to\n&quot; + email);&#10;    }&#10;&#10;    private void setupListeners() {&#10;        resendText.setOnClickListener(v -&gt; resendCode());&#10;&#10;        // Auto-focus next field with backspace support&#10;        setupCodeInput(code1, null, code2);&#10;        setupCodeInput(code2, code1, code3);&#10;        setupCodeInput(code3, code2, code4);&#10;        setupCodeInput(code4, code3, code5);&#10;        setupCodeInput(code5, code4, code6);&#10;        setupCodeInput(code6, code5, null);&#10;    }&#10;&#10;    private void setupCodeInput(EditText current, EditText previous, EditText next) {&#10;        current.addTextChangedListener(new TextWatcher() {&#10;            private boolean isDeleting = false;&#10;            &#10;            @Override&#10;            public void beforeTextChanged(CharSequence s, int start, int count, int after) {&#10;                isDeleting = count &gt; after;&#10;            }&#10;&#10;            @Override&#10;            public void onTextChanged(CharSequence s, int start, int before, int count) {&#10;                if (s.length() == 1) {&#10;                    if (next != null) {&#10;                        next.requestFocus();&#10;                    }&#10;                    // Check if all fields are filled for auto-verification&#10;                    checkAndAutoVerify();&#10;                } else if (s.length() == 0 &amp;&amp; previous != null &amp;&amp; isDeleting) {&#10;                    previous.requestFocus();&#10;                    // Select all text in previous field so it can be replaced&#10;                    previous.setSelection(previous.getText().length());&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void afterTextChanged(Editable s) {&#10;                // Limit to single character&#10;                if (s.length() &gt; 1) {&#10;                    s.delete(1, s.length());&#10;                }&#10;            }&#10;        });&#10;        &#10;        // Handle backspace on empty field&#10;        current.setOnKeyListener((v, keyCode, event) -&gt; {&#10;            if (keyCode == android.view.KeyEvent.KEYCODE_DEL &amp;&amp; &#10;                event.getAction() == android.view.KeyEvent.ACTION_DOWN &amp;&amp;&#10;                current.getText().toString().isEmpty() &amp;&amp; previous != null) {&#10;                previous.requestFocus();&#10;                previous.setSelection(previous.getText().length());&#10;                return true;&#10;            }&#10;            return false;&#10;        });&#10;    }&#10;    &#10;    private void checkAndAutoVerify() {&#10;        String code = code1.getText().toString() + &#10;                     code2.getText().toString() + &#10;                     code3.getText().toString() + &#10;                     code4.getText().toString() + &#10;                     code5.getText().toString() + &#10;                     code6.getText().toString();&#10;&#10;        if (code.length() == 6) {&#10;            // All fields filled, auto-verify&#10;            verifyCode();&#10;        }&#10;    }&#10;&#10;    private void startResendTimer() {&#10;        resendText.setEnabled(false);&#10;        resendText.setAlpha(0.5f);&#10;        &#10;        countDownTimer = new CountDownTimer(60000, 1000) {&#10;            @Override&#10;            public void onTick(long millisUntilFinished) {&#10;                resendText.setText(&quot;Resend code in &quot; + (millisUntilFinished / 1000) + &quot;s&quot;);&#10;            }&#10;&#10;            @Override&#10;            public void onFinish() {&#10;                resendText.setText(&quot;Resend Code&quot;);&#10;                resendText.setEnabled(true);&#10;                resendText.setAlpha(1.0f);&#10;            }&#10;        }.start();&#10;    }&#10;&#10;    private void verifyCode() {&#10;        String code = code1.getText().toString() + &#10;                     code2.getText().toString() + &#10;                     code3.getText().toString() + &#10;                     code4.getText().toString() + &#10;                     code5.getText().toString() + &#10;                     code6.getText().toString();&#10;&#10;        Log.d(&quot;VerificationActivity&quot;, &quot;=== VERIFY CODE CALLED ===&quot;);&#10;        Log.d(&quot;VerificationActivity&quot;, &quot;Code length: &quot; + code.length());&#10;        Log.d(&quot;VerificationActivity&quot;, &quot;Code: &quot; + code);&#10;        Log.d(&quot;VerificationActivity&quot;, &quot;Email: &quot; + email);&#10;&#10;        if (code.length() != 6) {&#10;            Toast.makeText(this, &quot;Please enter the complete verification code&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        // Redirect to new registration flow since OTP verification is no longer used&#10;        Intent intent = new Intent(SignUpEmailVerificationActivity.this, RegisterActivity.class);&#10;        intent.putExtra(&quot;userRole&quot;, userRole);&#10;        intent.putExtra(&quot;firstName&quot;, firstName);&#10;        intent.putExtra(&quot;lastName&quot;, lastName);&#10;        intent.putExtra(&quot;dob&quot;, dob);&#10;        intent.putExtra(&quot;phone&quot;, phone);&#10;        intent.putExtra(&quot;email&quot;, email);&#10;        startActivity(intent);&#10;        finish();&#10;    }&#10;&#10;    private void resendCode() {&#10;        // Since we're using email confirmation instead of OTP, just show a message&#10;        Toast.makeText(this, &quot;Please use the new registration flow&quot;, Toast.LENGTH_SHORT).show();&#10;        // Redirect to new registration flow&#10;        Intent intent = new Intent(this, RegisterActivity.class);&#10;        intent.putExtra(&quot;userRole&quot;, userRole);&#10;        intent.putExtra(&quot;firstName&quot;, firstName);&#10;        intent.putExtra(&quot;lastName&quot;, lastName);&#10;        intent.putExtra(&quot;dob&quot;, dob);&#10;        intent.putExtra(&quot;phone&quot;, phone);&#10;        intent.putExtra(&quot;email&quot;, email);&#10;        startActivity(intent);&#10;        finish();&#10;    }&#10;&#10;    private void proceedToPassword(String otp) {&#10;        Intent intent = new Intent(this, SignUpPasswordActivity.class);&#10;        intent.putExtra(&quot;userRole&quot;, userRole);&#10;        intent.putExtra(&quot;firstName&quot;, firstName);&#10;        intent.putExtra(&quot;lastName&quot;, lastName);&#10;        intent.putExtra(&quot;dob&quot;, dob);&#10;        intent.putExtra(&quot;phone&quot;, phone);&#10;        intent.putExtra(&quot;email&quot;, email);&#10;        intent.putExtra(&quot;otp&quot;, otp);&#10;        startActivity(intent);&#10;        overridePendingTransition(R.anim.slide_in_right, R.anim.slide_out_left);&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        if (countDownTimer != null) {&#10;            countDownTimer.cancel();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onBackPressed() {&#10;        super.onBackPressed();&#10;        overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_right);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.roominate.activities.auth;&#10;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.os.CountDownTimer;&#10;import android.text.Editable;&#10;import android.text.TextWatcher;&#10;import android.util.Log;&#10;import android.view.View;&#10;import android.widget.EditText;&#10;import android.widget.ImageView;&#10;import android.widget.ProgressBar;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import com.roominate.R;&#10;import com.roominate.services.SupabaseClient;&#10;import org.json.JSONObject;&#10;&#10;public class SignUpEmailVerificationActivity extends AppCompatActivity {&#10;&#10;    private ImageView logoImage;&#10;    private TextView titleText;&#10;    private TextView emailText;&#10;    private EditText code1, code2, code3, code4, code5, code6;&#10;    private TextView resendText;&#10;    private ProgressBar progressBar;&#10;    &#10;    private String userRole, firstName, lastName, dob, phone, email;&#10;    private CountDownTimer countDownTimer;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        &#10;        // Hide ActionBar if present&#10;        if (getSupportActionBar() != null) {&#10;            getSupportActionBar().hide();&#10;        }&#10;        &#10;        setContentView(R.layout.activity_signup_email_verification);&#10;&#10;        // Get data from previous screens&#10;        userRole = getIntent().getStringExtra(&quot;userRole&quot;);&#10;        firstName = getIntent().getStringExtra(&quot;firstName&quot;);&#10;        lastName = getIntent().getStringExtra(&quot;lastName&quot;);&#10;        dob = getIntent().getStringExtra(&quot;dob&quot;);&#10;        phone = getIntent().getStringExtra(&quot;phone&quot;);&#10;        email = getIntent().getStringExtra(&quot;email&quot;);&#10;&#10;        initializeViews();&#10;        setupListeners();&#10;        startResendTimer();&#10;&#10;        // Send OTP when activity starts using the recently implemented function&#10;        sendOtp();&#10;    }&#10;&#10;    private void initializeViews() {&#10;        logoImage = findViewById(R.id.logoImage);&#10;        titleText = findViewById(R.id.titleText);&#10;        emailText = findViewById(R.id.emailText);&#10;        code1 = findViewById(R.id.code1);&#10;        code2 = findViewById(R.id.code2);&#10;        code3 = findViewById(R.id.code3);&#10;        code4 = findViewById(R.id.code4);&#10;        code5 = findViewById(R.id.code5);&#10;        code6 = findViewById(R.id.code6);&#10;        resendText = findViewById(R.id.resendText);&#10;        progressBar = findViewById(R.id.progressBar);&#10;&#10;        emailText.setText(&quot;We've sent a 6-digit code to\n&quot; + email);&#10;    }&#10;&#10;    private void setupListeners() {&#10;        resendText.setOnClickListener(v -&gt; {&#10;            if (resendText.isEnabled()) {&#10;                sendOtp();&#10;            }&#10;        });&#10;&#10;        // Auto-focus next field with backspace support&#10;        setupCodeInput(code1, null, code2);&#10;        setupCodeInput(code2, code1, code3);&#10;        setupCodeInput(code3, code2, code4);&#10;        setupCodeInput(code4, code3, code5);&#10;        setupCodeInput(code5, code4, code6);&#10;        setupCodeInput(code6, code5, null);&#10;    }&#10;&#10;    private void setupCodeInput(EditText current, EditText previous, EditText next) {&#10;        current.addTextChangedListener(new TextWatcher() {&#10;            private boolean isDeleting = false;&#10;            &#10;            @Override&#10;            public void beforeTextChanged(CharSequence s, int start, int count, int after) {&#10;                isDeleting = count &gt; after;&#10;            }&#10;&#10;            @Override&#10;            public void onTextChanged(CharSequence s, int start, int before, int count) {&#10;                if (s.length() == 1) {&#10;                    if (next != null) {&#10;                        next.requestFocus();&#10;                    }&#10;                    // Check if all fields are filled for auto-verification&#10;                    checkAndAutoVerify();&#10;                } else if (s.length() == 0 &amp;&amp; previous != null &amp;&amp; isDeleting) {&#10;                    previous.requestFocus();&#10;                    // Select all text in previous field so it can be replaced&#10;                    previous.setSelection(previous.getText().length());&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void afterTextChanged(Editable s) {&#10;                // Limit to single character&#10;                if (s.length() &gt; 1) {&#10;                    s.delete(1, s.length());&#10;                }&#10;            }&#10;        });&#10;        &#10;        // Handle backspace on empty field&#10;        current.setOnKeyListener((v, keyCode, event) -&gt; {&#10;            if (keyCode == android.view.KeyEvent.KEYCODE_DEL &amp;&amp; &#10;                event.getAction() == android.view.KeyEvent.ACTION_DOWN &amp;&amp;&#10;                current.getText().toString().isEmpty() &amp;&amp; previous != null) {&#10;                previous.requestFocus();&#10;                previous.setSelection(previous.getText().length());&#10;                return true;&#10;            }&#10;            return false;&#10;        });&#10;    }&#10;    &#10;    private void checkAndAutoVerify() {&#10;        String code = code1.getText().toString() + &#10;                     code2.getText().toString() + &#10;                     code3.getText().toString() + &#10;                     code4.getText().toString() + &#10;                     code5.getText().toString() + &#10;                     code6.getText().toString();&#10;&#10;        if (code.length() == 6) {&#10;            // All fields filled, auto-verify&#10;            verifyCode();&#10;        }&#10;    }&#10;&#10;    private void startResendTimer() {&#10;        resendText.setEnabled(false);&#10;        resendText.setAlpha(0.5f);&#10;        &#10;        countDownTimer = new CountDownTimer(60000, 1000) {&#10;            @Override&#10;            public void onTick(long millisUntilFinished) {&#10;                resendText.setText(&quot;Resend code in &quot; + (millisUntilFinished / 1000) + &quot;s&quot;);&#10;            }&#10;&#10;            @Override&#10;            public void onFinish() {&#10;                resendText.setText(&quot;Resend Code&quot;);&#10;                resendText.setEnabled(true);&#10;                resendText.setAlpha(1.0f);&#10;            }&#10;        }.start();&#10;    }&#10;&#10;    private void verifyCode() {&#10;        String code = code1.getText().toString() + &#10;                     code2.getText().toString() + &#10;                     code3.getText().toString() + &#10;                     code4.getText().toString() + &#10;                     code5.getText().toString() + &#10;                     code6.getText().toString();&#10;&#10;        Log.d(&quot;VerificationActivity&quot;, &quot;=== VERIFY CODE CALLED ===&quot;);&#10;        Log.d(&quot;VerificationActivity&quot;, &quot;Code length: &quot; + code.length());&#10;        Log.d(&quot;VerificationActivity&quot;, &quot;Code: &quot; + code);&#10;        Log.d(&quot;VerificationActivity&quot;, &quot;Email: &quot; + email);&#10;&#10;        if (code.length() != 6) {&#10;            Toast.makeText(this, &quot;Please enter the complete verification code&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        // Show progress&#10;        progressBar.setVisibility(View.VISIBLE);&#10;        // Disable inputs&#10;        resendText.setEnabled(false);&#10;&#10;        SupabaseClient.getInstance().verifyOtp(email, code, new SupabaseClient.ApiCallback() {&#10;            @Override&#10;            public void onSuccess(JSONObject response) {&#10;                runOnUiThread(() -&gt; {&#10;                    progressBar.setVisibility(View.GONE);&#10;                    // OTP verified, proceed to password/setup flow&#10;                    Toast.makeText(SignUpEmailVerificationActivity.this, &quot;Verification successful&quot;, Toast.LENGTH_SHORT).show();&#10;                    proceedToPassword(code);&#10;                });&#10;            }&#10;&#10;            @Override&#10;            public void onError(String error) {&#10;                runOnUiThread(() -&gt; {&#10;                    progressBar.setVisibility(View.GONE);&#10;                    resendText.setEnabled(true);&#10;                    Toast.makeText(SignUpEmailVerificationActivity.this, &quot;Verification failed: &quot; + error, Toast.LENGTH_LONG).show();&#10;                });&#10;            }&#10;        });&#10;    }&#10;&#10;    private void sendOtp() {&#10;        if (email == null || email.isEmpty()) {&#10;            Toast.makeText(this, &quot;Missing email address&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        // Show progress and disable resend&#10;        progressBar.setVisibility(View.VISIBLE);&#10;        resendText.setEnabled(false);&#10;        resendText.setAlpha(0.5f);&#10;&#10;        SupabaseClient.getInstance().requestOtp(email, new SupabaseClient.ApiCallback() {&#10;            @Override&#10;            public void onSuccess(JSONObject response) {&#10;                runOnUiThread(() -&gt; {&#10;                    progressBar.setVisibility(View.GONE);&#10;                    Toast.makeText(SignUpEmailVerificationActivity.this, &quot;Verification code sent â€” check your email.&quot;, Toast.LENGTH_LONG).show();&#10;                    // restart resend timer&#10;                    if (countDownTimer != null) {&#10;                        countDownTimer.cancel();&#10;                    }&#10;                    startResendTimer();&#10;                });&#10;            }&#10;&#10;            @Override&#10;            public void onError(String error) {&#10;                runOnUiThread(() -&gt; {&#10;                    progressBar.setVisibility(View.GONE);&#10;                    resendText.setEnabled(true);&#10;                    resendText.setAlpha(1.0f);&#10;                    Toast.makeText(SignUpEmailVerificationActivity.this, &quot;Failed to send verification code: &quot; + error, Toast.LENGTH_LONG).show();&#10;                });&#10;            }&#10;        });&#10;    }&#10;&#10;    private void resendCode() {&#10;        // This method is kept for backward compatibility but we'll call sendOtp now&#10;        sendOtp();&#10;    }&#10;&#10;    private void proceedToPassword(String otp) {&#10;        Intent intent = new Intent(this, SignUpPasswordActivity.class);&#10;        intent.putExtra(&quot;userRole&quot;, userRole);&#10;        intent.putExtra(&quot;firstName&quot;, firstName);&#10;        intent.putExtra(&quot;lastName&quot;, lastName);&#10;        intent.putExtra(&quot;dob&quot;, dob);&#10;        intent.putExtra(&quot;phone&quot;, phone);&#10;        intent.putExtra(&quot;email&quot;, email);&#10;        intent.putExtra(&quot;otp&quot;, otp);&#10;        startActivity(intent);&#10;        overridePendingTransition(R.anim.slide_in_right, R.anim.slide_out_left);&#10;        finish();&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        if (countDownTimer != null) {&#10;            countDownTimer.cancel();&#10;        }&#10;    }&#10;&#10;    @Override&#10;    public void onBackPressed() {&#10;        super.onBackPressed();&#10;        overridePendingTransition(R.anim.slide_in_left, R.anim.slide_out_right);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>